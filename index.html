<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Jak odzyskać ciało, umysł i duszę po toksycznej relacji</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <nav class="top-nav" aria-label="Główne menu">
      <div class="container">
        <div class="logo">
          <a href="./" title="EgoExplained.com">ego <span>x</span></a>
        </div>

        <!-- MENU dopasowane do .menu ul / .menu ul li / .menu ul a -->
        <div class="menu">
          <ul role="list">
            <li><a href="#about">O książce</a></li>
            <li><a href="#lets-talk">Kontakt</a></li>
            <li>
              <a
                href="https://www.youtube.com/@DekodujNarcyza"
                target="_blank"
                rel="noopener noreferrer"
                class="menu-link yt"
                aria-label="Otwórz kanał YouTube: Dekoduj Narcyza"
              >
                <img
                  class="menu-icon"
                  src="img/logo.png"
                  alt=""
                  aria-hidden="true"
                />
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="container" id="home">
      <section class="hero" role="banner">
        <img src="img/cover.jpg" alt="Okładka książki - ilustracja" />

        <div class="copy">
          <!-- Semantyczny tytuł dla czytników -->
          <h1 class="sr-only">Koniec Iluzji — Czas na Prawdę</h1>

          <!-- Napis „pisany” literka po literce (pasuje do .code* w CSS) -->
          <div class="code-wrap" aria-hidden="false">
            <ul class="code">
              <li tabindex="0" class="digit"><span>K</span></li>
              <li tabindex="0" class="digit"><span>o</span></li>
              <li tabindex="0" class="digit"><span>n</span></li>
              <li tabindex="0" class="digit"><span>i</span></li>
              <li tabindex="0" class="digit"><span>e</span></li>
              <li tabindex="0" class="digit"><span>c</span></li>
              <li class="digit space"><span> </span></li>
              <li tabindex="0" class="digit"><span>I</span></li>
              <li tabindex="0" class="digit"><span>l</span></li>
              <li tabindex="0" class="digit"><span>u</span></li>
              <li tabindex="0" class="digit"><span>z</span></li>
              <li tabindex="0" class="digit"><span>j</span></li>
              <li tabindex="0" class="digit"><span>i</span></li>
              <li class="digit space"><span> </span></li>
              <li tabindex="0" class="digit"><span>C</span></li>
              <li tabindex="0" class="digit"><span>z</span></li>
              <li tabindex="0" class="digit"><span>a</span></li>
              <li tabindex="0" class="digit"><span>s</span></li>
              <li class="digit space"><span> </span></li>
              <li tabindex="0" class="digit"><span>n</span></li>
              <li tabindex="0" class="digit"><span>a</span></li>
              <li class="digit space"><span> </span></li>
              <li tabindex="0" class="digit"><span>P</span></li>
              <li tabindex="0" class="digit"><span>r</span></li>
              <li tabindex="0" class="digit"><span>a</span></li>
              <li tabindex="0" class="digit"><span>w</span></li>
              <li tabindex="0" class="digit"><span>d</span></li>
              <li tabindex="0" class="digit"><span>ę</span></li>
            </ul>
          </div>

          <div class="video-wrap">
            <iframe
              title="Trailer: Jak odzyskać ciało, umysł i duszę po toksycznej relacji"
              src="https://www.youtube-nocookie.com/embed/I14a6pIJYZg?rel=0&modestbranding=1"
              loading="lazy"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
              referrerpolicy="strict-origin-when-cross-origin"
            ></iframe>
          </div>

          <h2>Kup Teraz</h2>
          <a class="btn" href="#">eBook</a>
          <a class="btn" href="#">Książka</a>
          <a class="btn" href="#">Audiobook</a>
        </div>
      </section>

      <!-- About + TOC (bez zmian strukturalnych) -->
      <section id="about">
        <!-- ... Twój istniejący markup sekcji about / toc ... -->
      </section>

      <section id="lets-talk" class="lets-talk">
        <h2>Kontakt</h2>
        <p>
          Jeśli chcesz podzielić się swoimi przemyśleniami, swoją historią lub
          zadać pytanie — napisz do mnie.
        </p>
        <a class="btn" href="mailto:contact@egoexplained.com"
          >Napisz wiadomość</a
        >
      </section>
    </main>

    <!-- Collapsible JS (bez zmian) -->
    <script>
      (function () {
        var toggles = document.querySelectorAll(".toggle");
        toggles.forEach(function (btn) {
          var targetId = btn.getAttribute("aria-controls");
          var content = document.getElementById(targetId);
          if (!content) return;
          btn.addEventListener("click", function () {
            var expanded = btn.getAttribute("aria-expanded") === "true";
            btn.setAttribute("aria-expanded", String(!expanded));
            if (expanded) {
              content.setAttribute("hidden", "");
              content.setAttribute("aria-hidden", "true");
              content.style.maxHeight = null;
            } else {
              content.removeAttribute("hidden");
              content.setAttribute("aria-hidden", "false");
              content.style.maxHeight = content.scrollHeight + "px";
            }
          });
        });
      })();
    </script>

    <!-- Grupowanie liter w słowa + efekt pisania dopasowany do CSS -->
    <script>
      (function () {
        const list = document.querySelector(".code");
        if (!list) return;

        // 1) Zgrupuj litery w słowa wg .digit.space
        const nodes = Array.from(list.children);
        if (nodes.length && !nodes.some((n) => n.classList.contains("word"))) {
          const words = [];
          let current = [];
          nodes.forEach((li) => {
            if (li.classList.contains("space")) {
              if (current.length) {
                words.push(current);
                current = [];
              }
              li.remove();
            } else {
              current.push(li);
            }
          });
          if (current.length) words.push(current);

          const frag = document.createDocumentFragment();
          words.forEach((letters) => {
            const word = document.createElement("li");
            word.className = "word";
            letters.forEach((l) => word.appendChild(l));
            frag.appendChild(word);
          });
          list.innerHTML = "";
          list.appendChild(frag);
        }

        // 2) Ustaw opóźnienia animacji liter (zgodnie z --type-stagger w CSS)
        const letters = list.querySelectorAll(".digit span");
        letters.forEach((el, i) => {
          el.style.setProperty("--delay", `calc(${i} * var(--type-stagger))`);
        });

        // 3) Start animacji, gdy nagłówek wejdzie w viewport
        const startTyping = () => list.classList.add("typing");
        const io = new IntersectionObserver(
          (entries) => {
            entries.forEach((e) => {
              if (e.isIntersecting) {
                startTyping();
                io.disconnect();
              }
            });
          },
          { threshold: 0.3 }
        );
        io.observe(list);

        // (opcjonalnie) podświetl słowo "Iluzji"
        Array.from(list.children).forEach((w) => {
          const txt = Array.from(w.querySelectorAll(".digit span"))
            .map((s) => s.textContent)
            .join("");
          if (txt === "Iluzji") w.classList.add("highlight");
        });
      })();
    </script>
  </body>
</html>
